{% extends 'base.html' %}

{% block title %}{{ test.title }} - MRI Training Platform{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Test Header -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">{{ test.title }}</h1>
        <p class="text-lg text-gray-600 mb-6">{{ test.description }}</p>
        
        <!-- Test Information -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 p-6 bg-gray-50 rounded-lg">
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600 mb-2">{{ test.get_total_questions }}</div>
                <div class="text-sm text-gray-600">Questions</div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600 mb-2">{{ test.time_limit_minutes }}</div>
                <div class="text-sm text-gray-600">Minutes</div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600 mb-2">{{ test.passing_score }}%</div>
                <div class="text-sm text-gray-600">Passing Score</div>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
            <h3 class="font-semibold text-blue-800 mb-2">Instructions:</h3>
            <ul class="list-disc list-inside text-blue-700 space-y-1">
                <li>You have {{ test.time_limit_minutes }} minutes to complete this test</li>
                <li>You must answer all questions</li>
                <li>You need {{ test.passing_score }}% or higher to pass</li>
                <li>Once started, the timer cannot be paused</li>
                <li>Camera must remain on during the entire test</li>
                <li>Click "Submit Test" when you're done</li>
            </ul>
        </div>
        
        <!-- UPDATED: Start Test Button now goes to consent form -->
        <div class="flex gap-4">
            <!-- CHANGED: href now points to test_consent instead of start_test -->
            <a href="{% url 'device_check' test.id %}" 
            class="bg-green-600 text-white px-6 py-4 rounded-lg hover:bg-green-700 transition font-semibold text-lg">
                Start Test
            </a>
            <a href="{% url 'dashboard' %}" 
               class="flex-1 bg-gray-300 text-gray-700 text-center py-4 rounded-lg hover:bg-gray-400 transition text-lg font-semibold">
                Back to Dashboard
            </a>
        </div>
    </div>
    
    <!-- Previous Attempts -->
    {% if previous_attempts %}
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Your Previous Attempts</h2>
        <div class="space-y-4">
            {% for attempt in previous_attempts %}
            <div class="border rounded-lg p-4 {% if attempt.passed %}bg-green-50{% else %}bg-red-50{% endif %}">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-semibold">{{ attempt.started_at|date:"M d, Y - g:i A" }}</div>
                        <div class="text-sm text-gray-600">
                            Status: {{ attempt.get_status_display }}
                        </div>
                    </div>
                    <div class="text-right">
                        {% if attempt.score is not None %}
                            <div class="text-2xl font-bold {% if attempt.passed %}text-green-600{% else %}text-red-600{% endif %}">
                                {{ attempt.score }}%
                            </div>
                            <div class="text-sm {% if attempt.passed %}text-green-600{% else %}text-red-600{% endif %}">
                                {% if attempt.passed %}✓ Passed{% else %}✗ Failed{% endif %}
                            </div>
                        {% else %}
                            <div class="text-gray-500">Not completed</div>
                        {% endif %}
                    </div>
                </div>
                {% if attempt.status == 'completed' %}
                <a href="{% url 'test_result' attempt.id %}" 
                   class="mt-3 inline-block text-blue-600 hover:underline">
                    View Results →
                </a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}