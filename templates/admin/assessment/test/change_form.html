{% extends "admin/change_form.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* Overall page styling */
    body {
        background: #f3f4f6 !important;
    }
    
    #content {
        background: transparent !important;
        padding: 0 !important;
    }
    
    #content-main {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    /* Django admin header fixes */
    #header {
        background: #2c3e50 !important;
        color: #ffffff !important;
        padding: 15px 20px !important;
    }
    
    #header a:link,
    #header a:visited {
        color: #4CAF50 !important;
        font-weight: 600 !important;
    }
    
    #branding h1 {
        color: #ffffff !important;
        font-weight: 700 !important;
    }
    
    /* Breadcrumbs styling */
    .breadcrumbs {
        background: #34495e !important;
        padding: 14px 20px !important;
        border-radius: 0 !important;
        margin-bottom: 0 !important;
        color: #ffffff !important;
    }
    
    .breadcrumbs a {
        color: #4CAF50 !important;
        font-weight: 600 !important;
        text-decoration: none !important;
    }
    
    .breadcrumbs a:hover {
        color: #66BB6A !important;
    }
    
    /* Sidebar styling improvements */
    #changelist-filter {
        background: #2c3e50 !important;
        border: none !important;
        border-radius: 12px !important;
        padding: 0 !important;
        margin-left: 20px !important;
    }
    
    #changelist-filter h2 {
        background: #34495e !important;
        color: #ffffff !important;
        padding: 18px 20px !important;
        margin: 0 !important;
        font-weight: 700 !important;
        font-size: 16px !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        border-radius: 12px 12px 0 0 !important;
    }
    
    #changelist-filter h3 {
        background: #34495e !important;
        color: #ffffff !important;
        padding: 14px 20px !important;
        margin: 0 !important;
        font-weight: 600 !important;
        font-size: 14px !important;
        border-top: 1px solid #2c3e50 !important;
    }
    
    #changelist-filter ul {
        padding: 10px 0 !important;
        margin: 0 !important;
        background: #34495e !important;
    }
    
    #changelist-filter li {
        padding: 10px 20px !important;
        color: #e0e0e0 !important;
        border-left: 3px solid transparent !important;
        transition: all 0.2s ease !important;
    }
    
    #changelist-filter li:hover {
        background: #3d566e !important;
        border-left-color: #4CAF50 !important;
    }
    
    #changelist-filter li.selected {
        background: #3d566e !important;
        border-left-color: #4CAF50 !important;
        font-weight: 600 !important;
    }
    
    #changelist-filter a {
        color: #e0e0e0 !important;
        text-decoration: none !important;
        display: block !important;
    }
    
    #changelist-filter a:hover {
        color: #ffffff !important;
    }
    
    #changelist-filter .addlink {
        color: #4CAF50 !important;
        font-weight: 600 !important;
        padding: 12px 20px !important;
        display: block !important;
    }
    
    #changelist-filter .addlink:hover {
        background: #3d566e !important;
        color: #66BB6A !important;
    }
    
    #changelist-filter .addlink:before {
        content: "➕ " !important;
        margin-right: 6px !important;
    }
    
    /* Header styling */
    .form-header {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        color: white;
        padding: 40px;
        border-radius: 12px;
        margin: 20px 0 30px 0;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.25);
    }
    
    .form-header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 700;
        color: white;
    }
    
    .form-header p {
        margin: 12px 0 0 0;
        opacity: 0.95;
        font-size: 1.1em;
        color: white;
    }
    
    /* Module/Fieldset styling */
    .module,
    fieldset.module {
        background: #ffffff !important;
        border: none !important;
        border-radius: 12px !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
        margin-bottom: 25px !important;
        overflow: hidden;
        border-left: 4px solid #4CAF50 !important;
    }
    
    .module h2,
    fieldset.module h2 {
        background: #f9fafb !important;
        color: #111827 !important;
        font-size: 1.3em !important;
        font-weight: 700 !important;
        padding: 20px 30px !important;
        margin: 0 !important;
        border-bottom: 2px solid #e5e7eb !important;
    }
    
    .module caption {
        background: #f9fafb !important;
        color: #111827 !important;
        font-size: 1.3em !important;
        font-weight: 700 !important;
        padding: 20px 30px !important;
        border-bottom: 2px solid #e5e7eb !important;
        text-align: left !important;
    }
    
    /* Form row styling */
    .form-row {
        padding: 20px 30px !important;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .form-row:last-child {
        border-bottom: none;
    }
    
    /* Label styling */
    .form-row label,
    .form-row > div > label {
        display: block;
        margin-bottom: 8px;
        color: #111827 !important;
        font-weight: 600 !important;
        font-size: 14px !important;
    }
    
    .form-row .help,
    .form-row .helptext {
        display: block;
        margin-top: 6px;
        color: #6b7280 !important;
        font-size: 13px !important;
        font-style: normal !important;
        line-height: 1.5;
    }
    
    /* Input field styling */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="url"],
    select,
    textarea {
        width: 100% !important;
        padding: 12px !important;
        border: 2px solid #d1d5db !important;
        border-radius: 8px !important;
        font-size: 14px !important;
        background-color: #ffffff !important;
        color: #1f2937 !important;
        box-sizing: border-box !important;
        transition: all 0.2s ease;
    }
    
    /* Select dropdown styling */
    select {
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M10.293 3.293L6 7.586 1.707 3.293A1 1 0 00.293 4.707l5 5a1 1 0 001.414 0l5-5a1 1 0 10-1.414-1.414z'/%3E%3C/svg%3E") !important;
        background-repeat: no-repeat !important;
        background-position: right 12px center !important;
        background-size: 12px !important;
        padding-right: 40px !important;
        cursor: pointer;
        min-height: 44px !important;
    }
    
    select::-ms-expand {
        display: none;
    }
    
    /* Focus states */
    input:focus,
    select:focus,
    textarea:focus {
        border-color: #4CAF50 !important;
        outline: none !important;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.15) !important;
        background-color: #ffffff !important;
    }
    
    input:hover,
    select:hover,
    textarea:hover {
        border-color: #9ca3af !important;
    }
    
    textarea {
        min-height: 120px !important;
        resize: vertical !important;
        font-family: inherit !important;
    }
    
    /* Checkbox styling */
    input[type="checkbox"] {
        width: 20px !important;
        height: 20px !important;
        cursor: pointer;
        margin-right: 8px;
        vertical-align: middle;
    }
    
    .vCheckboxLabel {
        margin-left: 0 !important;
        padding-left: 0 !important;
        display: inline !important;
    }
    
    /* Inline formset container */
    .inline-group {
        background: #ffffff;
        padding: 0 !important;
        border-radius: 8px;
        margin-top: 0 !important;
    }
    
    /* Tabular inline styling */
    .inline-group .tabular {
        background: transparent !important;
        border: none !important;
    }
    
    .inline-group table {
        width: 100% !important;
        border-collapse: collapse !important;
        background: #ffffff !important;
        margin: 0 !important;
    }
    
    /* Table header */
    .inline-group thead th {
        background: #2c3e50 !important;
        color: #ffffff !important;
        font-weight: 600 !important;
        padding: 16px 14px !important;
        text-align: left !important;
        border: none !important;
        font-size: 13px !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
    }
    
    .inline-group thead th:first-child {
        border-top-left-radius: 8px;
    }
    
    .inline-group thead th:last-child {
        border-top-right-radius: 8px;
    }
    
    .inline-group thead th a {
        color: #ffffff !important;
    }
    
    /* Table body */
    .inline-group tbody td {
        padding: 14px !important;
        border-bottom: 1px solid #e5e7eb !important;
        color: #1f2937 !important;
        background: #ffffff !important;
        vertical-align: middle !important;
    }
    
    .inline-group tbody tr:hover td {
        background: #f9fafb !important;
    }
    
    .inline-group tbody tr.row1 {
        background: #ffffff !important;
    }
    
    .inline-group tbody tr.row2 {
        background: #fafbfc !important;
    }
    
    .inline-group tbody tr:last-child td {
        border-bottom: none !important;
    }
    
    /* Inline table inputs */
    .inline-group table select,
    .inline-group table input[type="number"],
    .inline-group table input[type="text"] {
        padding: 10px 12px !important;
        font-size: 14px !important;
        margin: 0 !important;
        min-height: 42px !important;
    }
    
    .inline-group table select {
        padding-right: 35px !important;
        background-position: right 10px center !important;
    }
    
    /* Delete checkbox column */
    .inline-group td.delete {
        text-align: center !important;
        width: 60px !important;
    }
    
    .inline-group td.delete input {
        margin: 0 auto !important;
    }
    
    .inline-group .delete-row {
        background: #fff5f5 !important;
    }
    
    /* Original column */
    .inline-group td.original {
        color: #6b7280 !important;
        font-size: 13px !important;
    }
    
    /* Add row button */
    .add-row {
        padding: 0 30px 20px 30px !important;
        background: #ffffff !important;
    }
    
    .add-row a {
        display: inline-block !important;
        padding: 12px 24px !important;
        background: #4CAF50 !important;
        color: white !important;
        text-decoration: none !important;
        border-radius: 8px !important;
        font-weight: 600 !important;
        font-size: 14px !important;
        transition: all 0.2s ease !important;
        box-shadow: 0 2px 4px rgba(76, 175, 80, 0.2) !important;
    }
    
    .add-row a:hover {
        background: #45a049 !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
    }
    
    .add-row a:before {
        content: "➕ ";
        margin-right: 6px;
    }
    
    /* Error messages */
    .errorlist {
        background: #fee2e2 !important;
        color: #991b1b !important;
        border-left: 4px solid #dc3545 !important;
        border-radius: 6px !important;
        padding: 12px 16px !important;
        margin: 10px 0 !important;
        list-style: none !important;
        font-weight: 600 !important;
    }
    
    .errorlist li {
        color: #991b1b !important;
        margin: 4px 0 !important;
    }
    
    .errors {
        background: #fee2e2 !important;
        color: #991b1b !important;
        padding: 8px 12px !important;
        border-radius: 4px !important;
    }
    
    /* Info box */
    .info-box {
        background: #dbeafe !important;
        padding: 18px 24px !important;
        border-radius: 8px !important;
        margin: 20px 30px !important;
        border-left: 4px solid #3b82f6 !important;
        color: #1e40af !important;
    }
    
    .info-box strong {
        color: #1e3a8a !important;
        display: block;
        margin-bottom: 8px;
        font-size: 15px !important;
    }
    
    .info-box p {
        margin: 0 !important;
        color: #1e40af !important;
        line-height: 1.6 !important;
    }
    
    /* Submit row */
    .submit-row {
        padding: 25px 30px !important;
        background: #ffffff !important;
        border-top: 2px solid #e5e7eb !important;
        margin-top: 30px !important;
        border-radius: 0 0 12px 12px !important;
    }
    
    .submit-row input[type="submit"],
    .submit-row .button,
    .submit-row a.button {
        padding: 12px 28px !important;
        border-radius: 8px !important;
        font-size: 15px !important;
        font-weight: 600 !important;
        border: none !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        margin-right: 10px !important;
        text-decoration: none !important;
        display: inline-block !important;
    }
    
    .submit-row input[type="submit"],
    .submit-row input[name="_save"],
    .submit-row input[name="_continue"],
    .submit-row input[name="_addanother"] {
        background: #4CAF50 !important;
        color: white !important;
        box-shadow: 0 2px 4px rgba(76, 175, 80, 0.2) !important;
    }
    
    .submit-row input[type="submit"]:hover {
        background: #45a049 !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
    }
    
    .submit-row .deletelink {
        background: #dc3545 !important;
        color: white !important;
        padding: 12px 28px !important;
        border-radius: 8px !important;
        font-weight: 600 !important;
    }
    
    .submit-row .deletelink:hover {
        background: #c82333 !important;
    }
    
    /* Multi-select widget (filter_horizontal) */
    .selector {
        border: 2px solid #d1d5db !important;
        border-radius: 8px !important;
        overflow: hidden !important;
    }
    
    .selector h2 {
        background: #4CAF50 !important;
        color: white !important;
        padding: 12px 16px !important;
        font-size: 14px !important;
        font-weight: 600 !important;
        margin: 0 !important;
    }
    
    .selector .selector-available,
    .selector .selector-chosen {
        background: #ffffff !important;
    }
    
    .selector select {
        border: none !important;
        background: #ffffff !important;
    }
    
    .selector-chooser {
        padding: 10px !important;
    }
    
    .selector-chooser li {
        padding: 8px !important;
    }
    
    .selector-chooseall,
    .selector-clearall {
        padding: 8px 16px !important;
        background: #f3f4f6 !important;
        border-radius: 6px !important;
        margin: 4px !important;
        cursor: pointer !important;
    }
    
    .selector-chooseall:hover,
    .selector-clearall:hover {
        background: #e5e7eb !important;
    }
    
    /* Grid layout for side-by-side fields */
    .form-row.field-time_limit_minutes,
    .form-row.field-passing_score {
        width: 48% !important;
        display: inline-block !important;
        vertical-align: top !important;
    }
    
    .form-row.field-passing_score {
        margin-left: 3% !important;
    }
    
    /* Related widget wrapper */
    .related-widget-wrapper {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
    }
    
    .related-widget-wrapper select,
    .related-widget-wrapper input {
        flex: 1 !important;
    }
    
    .related-widget-wrapper-link {
        flex-shrink: 0 !important;
    }
    
    /* Calendar and time widgets */
    .calendarbox,
    .clockbox {
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .form-header {
            padding: 24px 20px !important;
        }
        
        .form-header h1 {
            font-size: 1.8em !important;
        }
        
        .form-row {
            padding: 15px 20px !important;
        }
        
        .form-row.field-time_limit_minutes,
        .form-row.field-passing_score {
            width: 100% !important;
            margin-left: 0 !important;
        }
        
        .inline-group table {
            font-size: 13px !important;
        }
        
        .inline-group thead th,
        .inline-group tbody td {
            padding: 10px 8px !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div style="background: #f3f4f6; min-height: 100vh; padding: 20px;">
    <div style="max-width: 1200px; margin: 0 auto;">
        <div class="form-header">
            <h1>{% if original %}✏️ Edit Test{% else %}➕ Create New Test{% endif %}</h1>
            <p>{% if original %}Update the test configuration below{% else %}Configure a new test for your students{% endif %}</p>
        </div>
        
        {{ block.super }}
        
        <script type="text/javascript">
        (function($) {
            $(document).ready(function() {
                // Show/hide manual questions based on auto-generate checkbox
                const autoGen = $('#id_auto_generate_from_topics');
                const manualSection = $('.form-row.field-manual_questions');
                
                function toggleManualQuestions() {
                    if (autoGen.is(':checked')) {
                        manualSection.slideUp(200);
                    } else {
                        manualSection.slideDown(200);
                    }
                }
                
                autoGen.on('change', toggleManualQuestions);
                toggleManualQuestions();
            });
        })(django.jQuery);
        </script>
    </div>
</div>
{% endblock %}

{% block after_related_objects %}
<div class="info-box">
    <strong>💡 Configuration Tip</strong>
    <p>Specify the number of questions to include from each topic when auto-generating the test. The system will randomly select questions from each topic based on these distributions.</p>
</div>
{% endblock %}